databaseChangeLog:
  - changeSet:
      id: 1-0-103
      author: Liquibase
      changes:
        - createTable:
            tableName: groups
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_groups
              - column:
                  name: name
                  type: VARCHAR(255)

  - changeSet:
      id: 1-0-102
      author: Liquibase
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_users
              - column:
                  name: username
                  type: VARCHAR(36)
                  constraints:
                    nullable: false
              - column:
                  name: role
                  type: VARCHAR(255)
              - column:
                  name: fio
                  type: VARCHAR(255)
              - column:
                  name: group_id
                  type: BIGINT
        - addForeignKeyConstraint:
            baseTableName: users
            baseColumnNames: group_id
            constraintName: fk_users_group_id
            referencedTableName: groups
            referencedColumnNames: id

  - changeSet:
      id: 1-0-105
      author: Liquibase
      changes:
        - createTable:
            tableName: subjects
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_subjects
              - column:
                  name: name
                  type: VARCHAR(255)
              - column:
                  name: teacher_id
                  type: BIGINT
        - addForeignKeyConstraint:
            baseTableName: subjects
            baseColumnNames: teacher_id
            constraintName: fk_subjects_teacher_id
            referencedTableName: users
            referencedColumnNames: id

  - changeSet:
      id: 1-0-104
      author: Liquibase
      changes:
        - createTable:
            tableName: groups_to_subjects
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_groups_to_subjects
              - column:
                  name: group_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: subject_id
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: groups_to_subjects
            baseColumnNames: group_id
            constraintName: fk_groups_to_subjects_group_id
            referencedTableName: groups
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: groups_to_subjects
            baseColumnNames: subject_id
            constraintName: fk_groups_to_subjects_subject_id
            referencedTableName: subjects
            referencedColumnNames: id

  - changeSet:
      id: 1-0-107
      author: Liquibase
      changes:
        - createTable:
            tableName: templates
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_templates
              - column:
                  name: body
                  type: VARCHAR(255)

  - changeSet:
      id: 1-0-106
      author: Liquibase
      changes:
        - createTable:
            tableName: notifications
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_notifications
              - column:
                  name: template_id
                  type: BIGINT
              - column:
                  name: datetime
                  type: TIMESTAMP
              - column:
                  name: subject_id
                  type: BIGINT
              - column:
                  name: is_archived
                  type: BOOLEAN
        - addForeignKeyConstraint:
            baseTableName: notifications
            baseColumnNames: template_id
            constraintName: fk_notifications_template_id
            referencedTableName: templates
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: notifications
            baseColumnNames: subject_id
            constraintName: fk_notifications_subject_id
            referencedTableName: subjects
            referencedColumnNames: id

  - changeSet:
      id: 1-0-100
      author: Liquibase
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - createTable:
            tableName: queues
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_queues
              - column:
                  name: expiration_date
                  type: TIMESTAMP
              - column:
                  name: name
                  type: VARCHAR(255)
              - column:
                  name: subject_id
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: queues
            baseColumnNames: subject_id
            constraintName: fk_queues_subject_id
            referencedTableName: subjects
            referencedColumnNames: id

  - changeSet:
      id: 1-0-101
      author: Liquibase
      changes:
        - createTable:
            tableName: queues_to_users
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_queues_to_users
              - column:
                  name: queue_id
                  type: BIGINT
                  constraints:
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
        - addForeignKeyConstraint:
            baseTableName: queues_to_users
            baseColumnNames: queue_id
            constraintName: fk_queues_to_users_queue_id
            referencedTableName: queues
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: queues_to_users
            baseColumnNames: user_id
            constraintName: fk_queues_to_users_user_id
            referencedTableName: users
            referencedColumnNames: id

  - changeSet:
      id: 1-0-108
      author: Liquibase
      changes:
        - createTable:
            tableName: dialogs
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_dialogs
              - column:
                  name: is_closed
                  type: BOOLEAN
              - column:
                  name: author
                  type: BIGINT
              - column:
                  name: recipient
                  type: BIGINT
              - column:
                  name: subject_id
                  type: BIGINT
        - addForeignKeyConstraint:
            baseTableName: dialogs
            baseColumnNames: author
            constraintName: fk_dialogs_author
            referencedTableName: users
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: dialogs
            baseColumnNames: recipient
            constraintName: fk_dialogs_recipient
            referencedTableName: users
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: dialogs
            baseColumnNames: subject_id
            constraintName: fk_dialogs_subject_id
            referencedTableName: subjects
            referencedColumnNames: id

  - changeSet:
      id: 1-0-109
      author: Liquibase
      changes:
        - createTable:
            tableName: messages
            columns:
              - column:
                  name: id
                  type: BIGINT
                  constraints:
                    nullable: false
                    primaryKey: true
                    primaryKeyName: pk_messages
              - column:
                  name: body
                  type: VARCHAR(255)
              - column:
                  name: datetime
                  type: TIMESTAMP
              - column:
                  name: author
                  type: BIGINT
              - column:
                  name: recipient
                  type: BIGINT
              - column:
                  name: dialog_id
                  type: BIGINT
        - addForeignKeyConstraint:
            baseTableName: messages
            baseColumnNames: author
            constraintName: fk_messages_author
            referencedTableName: users
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: messages
            baseColumnNames: recipient
            constraintName: fk_messages_recipient
            referencedTableName: users
            referencedColumnNames: id
        - addForeignKeyConstraint:
            baseTableName: messages
            baseColumnNames: dialog_id
            constraintName: fk_messages_dialog_id
            referencedTableName: dialogs
            referencedColumnNames: id

  - changeSet:
      id: 1-0-110
      author: Liquibase
      changes:
        - addColumn:
            tableName: dialogs
            columns:
              - column:
                  name: first_message
                  type: BIGINT
        - addForeignKeyConstraint:
            baseTableName: dialogs
            baseColumnNames: first_message
            constraintName: fk_dialogs_first_message
            referencedTableName: messages
            referencedColumnNames: id